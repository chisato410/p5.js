<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>star</title>
    <style>
      canvas {
        background: #ddd;
        border: 1px solid #aaa;
      }
    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.min.js"></script>
    <script>
      let stars = [];

      function setup() {
        createCanvas(600, 400);
        noStroke();
      }

      function draw() {
        drawSky();

        // 5%の確率で毎フレーム新しい星を作る
        if (random(1) < 0.05) {
          stars.push(new Star(random(width), random(height / 2)));
        }

        // 星を描く
        for (let s of stars) {
          s.update();
          s.display();
        }

        // 透明度が0になった星は消す
        stars = stars.filter((s) => !s.isDead());
      }

      // 夜空のグラデ
      function drawSky() {
        for (let y = 0; y < height; y++) {
          let c = lerpColor(color(10, 10, 30), color(0, 0, 0), y / height);
          stroke(c);
          line(0, y, width, y);
        }
      }

      // 星クラス
      class Star {
        constructor(x, y) {
          this.x = x;
          this.y = y;
          this.size = random(1, 3);
          // 明るさ（透明度）
          this.life = 255;
          // sinの開始位相をずらす
          this.phase = random(TWO_PI);
        }

        update() {
          // sin波で明るさを上下させながらフェードアウト
          this.life -= 1.5;
          this.alpha = map(
            sin(frameCount * 0.05 + this.phase),
            -1,
            1,
            100,
            255
          );
        }

        display() {
          fill(255, 255, 200, this.alpha * (this.life / 255));
          ellipse(this.x, this.y, this.size * 2);
        }

        isDead() {
          return this.life < 0;
        }
      }
    </script>
  </body>
</html>
