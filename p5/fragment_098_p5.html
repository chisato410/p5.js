<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Fragment #098 – “Dreaming Dog”</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, #111233, #2b1a3a);
      }
      canvas {
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      }
      .caption {
        position: absolute;
        left: 16px;
        bottom: 16px;
        color: #fff;
        font-family: Helvetica, Arial;
      }
    </style>
  </head>
  <body>
    <div class="caption">Fragment #098 – “Dreaming Dog”</div>
    <script>
      let floats = [];
      let dogY;
      function setup() {
        createCanvas(500, 500);
        colorMode(HSL);
        dogY = height * 0.68;
        // floating dream items
        const POOL = ["bone", "star", "moon"];
        for (let i = 0; i < 60; i++) {
          floats.push({
            type: random(POOL),
            x: random(width),
            y: random(height, height + 400),
            r: random(8, 28),
            vx: random(-0.4, 0.4),
            vy: random(-0.6, -0.2),
            off: random(1000),
            rot: random(TWO_PI),
          });
        }
        textAlign(CENTER, CENTER);
      }
      function draw() {
        // soft night gradient background
        for (let y = 0; y < height; y++) {
          let c = lerpColor(color(248, 20, 10), color(270, 60, 10), y / height);
          stroke(c);
          line(0, y, width, y);
        }
        // stars distant
        noStroke();
        for (let i = 0; i < 80; i++) {
          fill(60, 10, 95, random(0.05, 0.25));
          ellipse(random(width), random(height * 0.4), random(1, 3));
        }

        // floating dream objects (rising)
        for (let f of floats) {
          push();
          translate(
            f.x + sin(frameCount * 0.01 + f.off) * 8,
            f.y + cos(frameCount * 0.01 + f.off) * 4
          );
          rotate(sin(frameCount * 0.01 + f.off) * 0.4);
          if (f.type === "bone") {
            drawBone(0, 0, f.r);
          } else if (f.type === "star") {
            drawStar(0, 0, f.r);
          } else {
            drawMoon(0, 0, f.r);
          }
          pop();
          f.x += f.vx;
          f.y += f.vy;
          if (f.y < -80) {
            f.y = height + random(20, 300);
            f.x = random(width);
          }
        }

        // dreamy glow behind dog
        noStroke();
        fill(260, 60, 80, 0.06);
        ellipse(width / 2, dogY - 30, 380, 160);

        // simple sleeping dog silhouette
        drawDog(width / 2, dogY);

        // floating tiny motes
        for (let i = 0; i < 40; i++) {
          fill(50, 30, 90, 0.02 + noise(i * 0.1, frameCount * 0.01) * 0.08);
          ellipse((frameCount * 0.3 + i * 47) % width, (i * 23) % height, 3);
        }
      }

      function drawDog(cx, cy) {
        push();
        translate(cx, cy);
        noStroke();
        fill(40, 80, 20); // warm dark
        // body
        ellipse(0, 0, 260, 110);
        // head
        ellipse(-80, -10, 90, 70);
        // ear
        ellipse(-110, -30, 30, 40);
        // tail
        push();
        translate(110, -10);
        rotate(sin(frameCount * 0.02) * 0.3);
        ellipse(0, 0, 40, 12);
        pop();
        // eye (sleep)
        fill(0);
        stroke(0);
        strokeWeight(1);
        noFill();
        stroke(0);
        arc(-92, -8, 20, 12, PI * 0.1, PI * 0.9);
        pop();
      }

      function drawBone(x, y, s) {
        push();
        translate(x, y);
        noStroke();
        fill(50, 40, 95, 0.95);
        rectMode(CENTER);
        rect(0, 0, s * 1.2, s * 0.5, s * 0.2);
        ellipse(-s * 0.6, 0, -s * 0.3, s * 0.3); // decorative ends
        pop();
      }
      function drawStar(x, y, s) {
        push();
        translate(x, y);
        fill(50, 60, 90, 0.9);
        beginShape();
        for (let a = 0; a < TWO_PI; a += TWO_PI / 5) {
          let r = a % (TWO_PI / (TWO_PI / 5)) === 0 ? s : s * 0.45;
          vertex(cos(a) * r, sin(a) * r);
          a += TWO_PI / 10;
        }
        endShape(CLOSE);
        pop();
      }
      function drawMoon(x, y, s) {
        push();
        translate(x, y);
        fill(50, 40, 95, 0.95);
        ellipse(0, 0, s, s);
        fill(260, 40, 10, 0.12);
        ellipse(s * 0.25, -s * 0.1, s * 0.6);
        pop();
      }

      function keyPressed() {
        if (key === "s") saveCanvas("Fragment #098 – “Dreaming Dog”", "png");
      }
    </script>
  </body>
</html>
