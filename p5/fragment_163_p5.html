<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>River</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      canvas {
        display: block;
      }
      .caption {
        position: absolute;
        left: 16px;
        bottom: 16px;
        color: #000000;
        font-family: Helvetica, Arial;
        z-index: 10;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="caption">“River”</div>
    <script>
      let particle = [];
      let particleNum = 5000;
      let magnity = 0;
      let speed = 0.001;
      let r = 10;
      let colorRandom = [];
      let strokeRandom = [];
      let weights = [];

      function setup() {
        createCanvas(windowWidth, windowHeight);
        background(255);
        colorMode(HSB);

        noStroke();
        fill(255);
        frameRate(30);

        colorRandom = [
          color(220, 80, 40),
          color(200, 60, 90),
          color(240, 70, 30),
          color(190, 40, 95),
          color(210, 90, 60),
          color(205, 20, 100),
        ];

        strokeRandom = [1, 2, 0.5, 4, 3, 2.5];
        weights = [5, 3, 2, 2, 4, 1];

        rect(width / 4, 0, width / 2, height);
        addP();
      }

      function draw() {
        push();
        translate(width / 2, height / 2);
        for (let j = 0; j < particle.length; j++) {
          particle[j].update();
          particle[j].display();
        }
        magnity += speed;
        pop();

        for (let j = 0; j < 1000; j++) {
          noFill();
          stroke(210, 20, 100, 0.1);
          point(random(width), random(height));
        }
      }

      function addP(number) {
        for (let i = 0; i < particleNum; i++) {
          let uni = new drawParticle(
            random(-windowWidth / 4, windowWidth / 4),
            random(-height / 2, height / 2)
          );
          particle.push(uni);
        }
      }

      function seperation() {
        let step = height / 4;
        fill(255);
        noStroke();
        rect(width / 4, 0, 10, height);
      }

      function randomWeight(elements, weights) {
        let sum = 0;
        for (let i = 0; i < elements.length; i++) {
          sum += weights[i];
        }
        let rr = random(0, sum);
        for (let j = 0; j < elements.length; j++) {
          if (weights[j] >= rr) {
            return elements[j];
          }
          rr -= weights[j];
        }
      }

      class drawParticle {
        constructor(x, y) {
          this.pos = new createVector(x, y);
          this.vel = new createVector();
          this.weight = randomWeight(strokeRandom, weights);
          this.color = randomWeight(colorRandom, weights);
          this._noiseZ = 0.1;
        }

        update() {
          let noiseScale = 0.0015;
          let noiseStrength = 10;
          let xoffset = 1;
          let yoffset = 2;

          let noiseValue = noise(
            this.pos.x * noiseScale + xoffset,
            this.pos.y * noiseScale + yoffset
          );
          let ang = noiseValue * 2 * PI * noiseStrength;

          this.pos.x += cos(ang) * magnity;
          this.pos.y += sin(ang) * magnity;

          if (
            this.pos.x < -width / 2 ||
            this.pos.x > width / 2 ||
            this.pos.y < -height / 2 ||
            this.pos.y > height / 2
          ) {
            this.pos.set(
              random(-width / 2, width / 2),
              random(-height / 2, height / 2)
            );
          }
        }

        display() {
          fill(this.color);
          noStroke();
          circle(this.pos.x, this.pos.y, this.weight);
        }
      }

      function mousePressed() {
        for (let j = 0; j < particleNum / 100; j++) {
          fill(210, 10, 100, 0.5);
          noStroke();
          circle(random(width), random(height), random(2, 12));
        }
      }
    </script>
  </body>
</html>
