<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Crystal Fractal Tree</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
      body {
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      canvas {
        border: 4px double #ffff00;
        border-radius: 20px;
        width: 500px;
        height: 500px;
      }
      .caption {
        position: absolute;
        left: 16px;
        bottom: 16px;
        color: #fff;
        font-family: Helvetica, Arial;
      }
    </style>
  </head>
  <body>
    <div class="caption">Crystal Fractal Tree</div>
    <script>
      const depth = 7;
      const tree_size = 120;
      const relation = 1 / Math.sqrt(2);
      let angle = 0;

      function setup() {
        createCanvas(500, 500, WEBGL);
        noStroke();
        colorMode(HSB, 360, 100, 100, 1);
        background(210, 30, 95);
      }

      function draw() {
        background(210, 30, 95, 0.1);
        ambientLight(80);
        directionalLight(255, 255, 255, -0.5, -1, -0.5);
        pointLight(255, 255, 255, 0, 0, 200);
        orbitControl();
        rotateY(angle);
        angle += 0.003;
        push();
        translate(0, 50, 0);
        rotateX(-PI / 2);
        drawTreeBranches(tree_size, depth);
        pop();
      }

      function drawTreeBranches(current_size, current_depth) {
        if (current_depth === 0) return;
        push();
        const hue = map(current_depth, 0, depth, 200, 280);
        ambientMaterial(hue, 255, 255);
        specularMaterial(180, 200, 255);
        box(current_size);
        pop();
        push();
        translate(-current_size / 2, 0, current_size);
        rotateY(-PI / 4);
        drawTreeBranches(relation * current_size, current_depth - 1);
        pop();
        push();
        translate(current_size / 2, 0, current_size);
        rotateY(PI / 4);
        drawTreeBranches(relation * current_size, current_depth - 1);
        pop();
      }
    </script>
  </body>
</html>
