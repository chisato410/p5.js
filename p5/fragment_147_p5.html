<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Tangram Flow2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      canvas {
        display: block;
        width: 500px !important;
        height: 500px !important;
      }
      .caption {
        position: absolute;
        left: 16px;
        bottom: 16px;
        color: #443;
        font-family: Helvetica, Arial;
        z-index: 10;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="caption">“Tangram Flow2”</div>
    <script>
      // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
      // @garabatospr

      let colors = ["#3A6EF6", "#04090F", "#FAF0EE", "#DB2719", "#F5CB1D"];

      //let colors =["black","white","darkgray","lightgray","red","blue"];

      let particles = [];

      let border = -300;

      function setup() {
        createCanvas(1000, 1000);
        colorMode(HSB, 360, 100, 100, 100);
        rectMode(CENTER);
        // strokeCap(SQUARE);

        for (let x = border; x < width - border; x += 15) {
          for (let y = border; y < height - border; y += 15) {
            particles.push(new Particle(x, y, 10, 20));
          }
        }

        //fill(100);
        //square(width/2,height/2,width)
      }

      function draw() {
        //drawGrid();

        for (let i = 0; i < particles.length; i++) {
          particles[i].update();
        }

        drawGrid();

        noFill();
        stroke(100);
        strokeWeight(20);
        square(width / 2, height / 2, width);
      }

      class Particle {
        constructor(x, y, myThick, myScale) {
          this.p = createVector(x, y);
          this.pOld = createVector(this.p.x, this.p.y);
          (this.thick = myThick), (this.speed = 1);
          this.color = generateColor(10);
          this.direction = -1;
          this.scale = myScale;
        }

        update() {
          this.p.x +=
            this.speed *
            this.direction *
            vector_field(this.p.x, this.p.y, this.scale).x;
          this.p.y +=
            this.speed *
            this.direction *
            vector_field(this.p.x, this.p.y, this.scale).y;
          strokeWeight(this.thick);
          stroke(this.color);
          line(this.pOld.x, this.pOld.y, this.p.x, this.p.y);
          stroke(this.color);

          this.pOld.set(this.p);
        }
      }

      function vector_field(x, y, myScale) {
        x = map(x, border, width - border, 0, myScale);
        y = map(y, border, height - border, 0, myScale);

        let k1 = 5;
        let k2 = 3;

        let u = cos(k1 * y) + cos(k2 * y);
        let v = sin(k2 * x) - cos(k1 * x);

        return createVector(u, v);
      }

      function generateColor(scale) {
        return random(colors);
      }

      function drawGrid() {
        stroke(100);
        strokeWeight(20);

        for (let x = 20; x < height; x += 160) {
          line(0, x, width, x);
          line(x, 0, x, height);
        }

        stroke(0);
        strokeWeight(5);
        for (let x = 20; x < height; x += 160) {
          line(20, x, width - 20, x);
          line(x, 20, x, height - 20);
        }
      }
    </script>
  </body>
</html>
