<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Three Fragment Template</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #000;
        overflow: hidden;
        font-family: "Helvetica Neue", sans-serif;
      }

      #three-frame {
        width: 500px;
        height: 500px;
        background: #332a26;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.65);
      }

      .caption {
        position: fixed;
        bottom: 16px;
        left: 16px;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.75);
        letter-spacing: 0.05em;
        pointer-events: none;
      }

      canvas {
        width: 100%;
        height: 100%;
        border-radius: 16px;
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.min.js"></script>
  </head>

  <body>
    <div id="three-frame"></div>
    <div class="caption" id="caption">Fragment #000 – "Untitled"</div>

    <script>
      /* === Fragment Metadata === */
      const fragmentNumber = 0; // ← ここ変える
      const fragmentTitle = "Untitled"; // ← ここ変える

      document.getElementById("caption").innerText = `Fragment #${String(
        fragmentNumber
      ).padStart(3, "0")} – "${fragmentTitle}"`;

      /* === Three.js 基本セットアップ === */
      const frame = document.getElementById("three-frame");

      const scene = new THREE.Scene();
      scene.background = new THREE.Color("#332a26");

      const camera = new THREE.PerspectiveCamera(
        45,
        frame.clientWidth / frame.clientHeight,
        0.1,
        100
      );
      camera.position.set(2, 2, 3);
      camera.lookAt(0, 0, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(frame.clientWidth, frame.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      frame.appendChild(renderer.domElement);

      /* === Lights === */
      scene.add(new THREE.AmbientLight(0xffffff, 0.6));
      const light = new THREE.PointLight(0xffffff, 1.5);
      light.position.set(3, 5, 3);
      scene.add(light);

      /* === ▼ ここから作品コードを書く場所（中身だけ毎回変える） === */

      const geometry = new THREE.TorusKnotGeometry(0.7, 0.25, 200, 32);
      const material = new THREE.MeshStandardMaterial({
        color: 0xff99aa,
        roughness: 0.25,
        metalness: 0.75,
      });
      const mesh = new THREE.Mesh(geometry, material);
      scene.add(mesh);

      /* === ▲ 中身のコード（100作品ともここが変わる） === */

      /* === Animation Loop === */
      function animate() {
        requestAnimationFrame(animate);
        mesh.rotation.x += 0.01;
        mesh.rotation.y += 0.008;
        renderer.render(scene, camera);
      }
      animate();

      /* === SキーでPNG保存 === */
      window.addEventListener("keydown", (e) => {
        if (e.key === "s") {
          const url = renderer.domElement.toDataURL("image/png");
          const a = document.createElement("a");
          a.href = url;
          a.download = `fragment_${String(fragmentNumber).padStart(
            3,
            "0"
          )}.png`;
          a.click();
        }
      });

      /* === ウィンドウサイズに対応 === */
      window.addEventListener("resize", () => {
        const w = frame.clientWidth;
        const h = frame.clientHeight;
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
        renderer.setSize(w, h);
      });
    </script>
  </body>
</html>
